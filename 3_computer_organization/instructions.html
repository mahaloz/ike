<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Instructions - &#x27;Ike</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../1_introduction/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../1_introduction/background.html"><strong aria-hidden="true">1.1.</strong> Background</a></li><li class="chapter-item expanded "><a href="../1_introduction/inspiration.html"><strong aria-hidden="true">1.2.</strong> Inspiration</a></li><li class="chapter-item expanded "><a href="../1_introduction/overview.html"><strong aria-hidden="true">1.3.</strong> Overview & Schedule</a></li></ol></li><li class="chapter-item expanded "><a href="../2_operating_systems/operating_systems.html"><strong aria-hidden="true">2.</strong> Operating Systems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2_operating_systems/introduction.html"><strong aria-hidden="true">2.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../2_operating_systems/virtualization.html"><strong aria-hidden="true">2.2.</strong> Virtualization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2_operating_systems/virtual_machines.html"><strong aria-hidden="true">2.2.1.</strong> Virtual Machines</a></li><li class="chapter-item expanded "><a href="../2_operating_systems/containers.html"><strong aria-hidden="true">2.2.2.</strong> Containers</a></li></ol></li><li class="chapter-item expanded "><a href="../2_operating_systems/linux_os.html"><strong aria-hidden="true">2.3.</strong> Linux OS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2_operating_systems/terminal.html"><strong aria-hidden="true">2.3.1.</strong> The Terminal</a></li><li class="chapter-item expanded "><a href="../2_operating_systems/permissions.html"><strong aria-hidden="true">2.3.2.</strong> Permissions</a></li><li class="chapter-item expanded "><a href="../2_operating_systems/hacker_practice.html"><strong aria-hidden="true">2.3.3.</strong> Hacker Practice</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../3_computer_organization/computer_org.html"><strong aria-hidden="true">3.</strong> Computer Organization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3_computer_organization/introduction.html"><strong aria-hidden="true">3.1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3_computer_organization/math_and_counting.html"><strong aria-hidden="true">3.1.1.</strong> Math & Counting</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/bits_and_logic.html"><strong aria-hidden="true">3.1.2.</strong> Bits & Logic</a></li></ol></li><li class="chapter-item expanded "><a href="../3_computer_organization/memory.html"><strong aria-hidden="true">3.2.</strong> Memory</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3_computer_organization/programs_in_mem.html"><strong aria-hidden="true">3.2.1.</strong> Programs in Memory</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/addressing.html"><strong aria-hidden="true">3.2.2.</strong> Addressing</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/memory_segments.html"><strong aria-hidden="true">3.2.3.</strong> Memory Segments</a></li></ol></li><li class="chapter-item expanded "><a href="../3_computer_organization/assembly.html"><strong aria-hidden="true">3.3.</strong> Assembly</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3_computer_organization/registers.html"><strong aria-hidden="true">3.3.1.</strong> Registers</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/instructions.html" class="active"><strong aria-hidden="true">3.3.2.</strong> Instructions</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/asm_memory.html"><strong aria-hidden="true">3.3.3.</strong> ASM Memory</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/control_structures.html"><strong aria-hidden="true">3.3.4.</strong> Control Structures</a></li><li class="chapter-item expanded "><a href="../3_computer_organization/hacker_practice.html"><strong aria-hidden="true">3.3.5.</strong> Hacker Practice</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../4_programming_languages/programming_languages.html"><strong aria-hidden="true">4.</strong> Programming Languages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4_programming_languages/introduction.html"><strong aria-hidden="true">4.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../4_programming_languages/c.html"><strong aria-hidden="true">4.2.</strong> C</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4_programming_languages/write_c.html"><strong aria-hidden="true">4.2.1.</strong> Writing Code</a></li><li class="chapter-item expanded "><a href="../4_programming_languages/compilation.html"><strong aria-hidden="true">4.2.2.</strong> Compilation & Execution</a></li><li class="chapter-item expanded "><a href="../4_programming_languages/debugging_c.html"><strong aria-hidden="true">4.2.3.</strong> Debugging</a></li></ol></li><li class="chapter-item expanded "><a href="../4_programming_languages/python.html"><strong aria-hidden="true">4.3.</strong> Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4_programming_languages/write_py.html"><strong aria-hidden="true">4.3.1.</strong> Writing Code</a></li><li class="chapter-item expanded "><a href="../4_programming_languages/interp.html"><strong aria-hidden="true">4.3.2.</strong> Interpretation & Execution</a></li><li class="chapter-item expanded "><a href="../4_programming_languages/debugging_py.html"><strong aria-hidden="true">4.3.3.</strong> Debugging</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../5_processes/proc_and_debug.html"><strong aria-hidden="true">5.</strong> Processes and Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../5_processes/introduction.html"><strong aria-hidden="true">5.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../5_processes/executable_types.html"><strong aria-hidden="true">5.2.</strong> Executable Types</a></li><li class="chapter-item expanded "><a href="../5_processes/gdb.html"><strong aria-hidden="true">5.3.</strong> Using GDB</a></li><li class="chapter-item expanded "><a href="../5_processes/interaction.html"><strong aria-hidden="true">5.4.</strong> Interacting with Python</a></li></ol></li><li class="chapter-item expanded "><a href="../6_security/security.html"><strong aria-hidden="true">6.</strong> Security Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../6_security/cia.html"><strong aria-hidden="true">6.1.</strong> CIA</a></li><li class="chapter-item expanded "><a href="../6_security/enc_and_hash.html"><strong aria-hidden="true">6.2.</strong> Encryption & Hashing</a></li><li class="chapter-item expanded "><a href="../6_security/bruteforcing.html"><strong aria-hidden="true">6.3.</strong> Bruteforcing</a></li><li class="chapter-item expanded "><a href="../6_security/dos.html"><strong aria-hidden="true">6.4.</strong> DOSing</a></li><li class="chapter-item expanded "><a href="../6_security/io.html"><strong aria-hidden="true">6.5.</strong> I/O Vectors</a></li></ol></li><li class="chapter-item expanded "><a href="../whats_next.html"><strong aria-hidden="true">7.</strong> What's Next</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">&#x27;Ike</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="instructions"><a class="header" href="#instructions">Instructions</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>So you've learned where to store numbers in assembly, <a href="./registers.html">registers</a>. Your next logical question would be: <strong>how</strong> do I store values in those registers? Good question. You store them using <em>instructions</em>. </p>
<p>Instructions are <em>atomic</em> pieces of logic that run in order on the CPU. That sounds complicated, so let's break it down. Here is an example of something we want to do:</p>
<pre><code class="language-c">x = 10 
</code></pre>
<p>In assembly, where <code>x is rax</code>, this translates to:</p>
<pre><code class="language-c">mov rax, 10
</code></pre>
<blockquote>
<p>It's important to note that this format of x86 is in the flavor of Intel. There are two flavors: <a href="https://imada.sdu.dk/~kslarsen/dm546/Material/IntelnATT.htm">Intel and AT&amp;T</a>. For all the challenge, and this handbook, we will be using Intel format. </p>
</blockquote>
<p>This instruction is atomic because nothing can interrupt it and it is the lowest level of logic on a computer. In contrast, we could show this operation:</p>
<pre><code class="language-c">x = x + 10
</code></pre>
<p>The thing we are asking to do above is not atomic. It is actually composed of 3 parts (normally):</p>
<pre><code class="language-c">mov rbx, rax     // make a temp for x
add rbx, 10      // add 10 to that temp
mov rax, rbx     // move the temp back into x
</code></pre>
<p>You will also notice that these instructions execute one-after-another. They are linearly executed.</p>
<h2 id="instruction-syntax"><a class="header" href="#instruction-syntax">Instruction Syntax</a></h2>
<p>This syntax may be confusing but most instructions follow the same format:</p>
<pre><code>&lt;instruction_mnemonic&gt;  &lt;destination&gt;, &lt;source&gt;
</code></pre>
<p>So saying: <code>mov rax, rbx</code> means <code>move rbx to rax</code>. </p>
<p>There are some other more subtle things in this syntax, like the use of <code>[&lt;register_name&gt;]</code> in instructions. </p>
<blockquote>
<p>Recall: when we say [0x400000] this refers to the data at the address 0x400000. Review <a href="./memory.html">memory</a> for a recap.</p>
</blockquote>
<p>For instance:</p>
<pre><code>mov rax, [rbx]
</code></pre>
<p>This means move the <strong>the value at the address stored in rbx</strong> to rax. Usually other blogs and such will refer to this process as dereferencing rbx. </p>
<h2 id="instruction-execution"><a class="header" href="#instruction-execution">Instruction Execution</a></h2>
<p>In the <a href="./registers.html">registers</a> section we talked a little about special registers. Now it's time to talk about the most important of those special registers: <strong>rip</strong> (also referred to as ip).</p>
<p>IP in assembly land refers to the Instruction Pointer register. You can find an ip register in every architecture. This instruction is responsible for storing the address of the instruction we are supposed to be executing right now. Normally, when you have instructions that are a program they are laid out in memory. Here is how a typical memory layout full of instructions could look:</p>
<pre><code class="language-c">000000000000112d &lt;main&gt;:
112d:       push   rbp
112e:       mov    rbp,rsp
1131:       mov    [rbp-0x8], 0x0
1138:       mov    [rbp-0x4], 0x4
113f:       mov    eax, [rbp-0x4]
1142:       add    eax, 0x5
1145:       mov    [rbp-0x8], eax
1148:       mov    eax, [rbp-0x8]
114b:       imul   eax, [rbp-0x4]
114f:       mov    [rbp-0x8], eax
</code></pre>
<p>There are some important things to note here. First, you can dereference registers while adding or subtracting an offset to it like in <code>[rbp - 0x4]</code>. Second, the address each instruction is associated with is not singly incremental. Notice how the difference in address between some instructions is <code>7</code>, while others are only <code>1</code>. You may have guessed it, but the difference in addresses for each instruction is based on that instruction's size.</p>
<p>Each instruction is composed of bytes that encode it. Here is the same code from above, but printed with its encoding:</p>
<pre><code class="language-c">000000000000112d &lt;main&gt;:
112d:       55                      push   rbp
112e:       48 89 e5                mov    rbp,rsp
1131:       c7 45 f8 00 00 00 00    mov    [rbp-0x8], 0x0
1138:       c7 45 fc 04 00 00 00    mov    [rbp-0x4], 0x4
113f:       8b 45 fc                mov    eax, [rbp-0x4]
1142:       83 c0 05                add    eax, 0x5
1145:       89 45 f8                mov    [rbp-0x8], eax
1148:       8b 45 f8                mov    eax, [rbp-0x8]
114b:       0f af 45 fc             imul   eax, [rbp-0x4]
114f:       89 45 f8                mov    [rbp-0x8], eax
</code></pre>
<p>There is a lot of different semantics to encoding instructions, such as their type and operation, but I won't be talking about how you can encode instructions by hand in this handbook. If you are interested, check <a href="https://wiki.osdev.org/X86-64_Instruction_Encoding#Opcode">this out</a>.</p>
<p>If you are curious about how an instruction encodes into its bytes (or the other way around), use <a href="https://defuse.ca/online-x86-assembler.htm">this site</a> to encode and decode x86 instructions as you like. I use it often for CTFs since it's so easy to use.</p>
<p>Now back to our earlier discussion, the instruction pointer. Execution of instructions follows the <a href="https://en.wikipedia.org/wiki/Instruction_cycle">fetch-and-execute</a> cycle:</p>
<ol>
<li>Get the instruction at the address of the ip</li>
<li>Decode it</li>
<li>Execute it </li>
<li>Add the size of the current instruction to the ip</li>
<li>Repeat </li>
</ol>
<p>So if in our previous example we are about to execute <code>mov [rbp-0x8], 0x0</code>, that means that <code>rip = 0x1131</code>. This also means that <code>[0x1131]</code> is the bytes of the instruction <code>mov [rbp-0x8], 0x0</code>.</p>
<p>The last thing to know about <code>rip</code>, and <code>ip</code> in general, is that you are not allowed to modify this register yourself. Obviously you just having instructions in memory modifies <code>rip</code>, but you are not allowed to do things like:</p>
<pre><code>mov rip, 0x1138
</code></pre>
<p>That is an illegal instruction.</p>
<h2 id="common-instructions"><a class="header" href="#common-instructions">Common Instructions</a></h2>
<p>So you know instructions can do things, but what kind of instructions exist? Here are the most common instructions you will use/see in the wild:</p>
<blockquote>
<p>Note: when you see &lt;x | y&gt; it means that thing could be an <code>x</code> or a <code>y</code>; <code>C</code> means a constant, like <code>10</code>; <code>stack</code> means the stack (a region of memory) and is represented by a list.</p>
</blockquote>
<h3 id="math-operations"><a class="header" href="#math-operations">Math Operations</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Mnemonic</th><th>Arguments</th><th>Description</th><th>Python Equiv</th><th></th></tr></thead><tbody>
<tr><td>add</td><td>r1, &lt;r2 | C&gt;</td><td>Adds r2 to r1.</td><td>r1 += r2</td><td></td></tr>
<tr><td>sub</td><td>r1, &lt;r2 | C&gt;</td><td>Subtracts r2 from r1.</td><td>r1 -= r2</td><td></td></tr>
<tr><td>idiv</td><td>rax=divisor; rdx=dividend</td><td>Divides rdx by rax. Result in rax, remainder in rdx.</td><td>rdx // rax; rdx % rax</td><td></td></tr>
<tr><td>imul</td><td>r1, &lt;r2 | C&gt;</td><td>Multiplies r1 by r2.</td><td>r1 *= r2</td><td></td></tr>
</tbody></table>
</div>
<blockquote>
<p>Note: modulo can be accomplished with idiv and reading the value in rdx.</p>
</blockquote>
<p>The math operations above can be done both in a <a href="https://math.libretexts.org/Bookshelves/PreAlgebra/Book%3A_Fundamentals_of_Mathematics_(Burzynski_and_Ellis)/10%3A_Signed_Numbers/10.06%3A_Multiplication_and_Division_of_Signed_Numbers">signed and unsigned</a> way. This means that the numbers can be represented negatively or non-negatively which changes how we represent the output of the number.</p>
<blockquote>
<p>Recall: in <a href="./bits_and_logic.html">bits-and-logic</a> that we can represent negative values in x86 using <a href="https://en.wikipedia.org/wiki/Two%27s_complement">Two's Complement</a>, which makes the upper bits of a value <code>1</code> to represent negative. This affects how instructions output values. </p>
</blockquote>
<h3 id="logic-operations"><a class="header" href="#logic-operations">Logic Operations</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Mnemonic</th><th>Arguments</th><th>Description</th><th>Python Equiv</th><th></th></tr></thead><tbody>
<tr><td>and</td><td>r1, &lt;r2 | C&gt;</td><td>Logically ANDs r1 with r2</td><td>r1 &amp;= r2</td><td></td></tr>
<tr><td>or</td><td>r1, &lt;r2 | C&gt;</td><td>Logically ORs r1 with r2</td><td>r1 |= r2</td><td></td></tr>
<tr><td>xor</td><td>r1, &lt;r2 | C&gt;</td><td>Logically XORs r1 with r2</td><td>r1 ^= r2</td><td></td></tr>
<tr><td>not</td><td>r1</td><td>Logically NOTs r1 and sets it to r1</td><td>r1 = ~r1</td><td></td></tr>
</tbody></table>
</div>
<h3 id="storage-operations"><a class="header" href="#storage-operations">Storage Operations</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Mnemonic</th><th>Arguments</th><th>Description</th><th>Python Equiv</th><th></th></tr></thead><tbody>
<tr><td>mov</td><td>r1, &lt;r2 | C&gt;</td><td>Copies value in r2 and stores it in r1</td><td>r1 = r2</td><td></td></tr>
<tr><td>lea</td><td>r1, [r2 + C]</td><td>Stores computed address of r2+C in r1</td><td>r1 = r2 + C</td><td></td></tr>
<tr><td>push</td><td>&lt;r1 | C&gt;</td><td>Places r1 on the top of the stack</td><td>stack += [r1]</td><td></td></tr>
<tr><td>pop</td><td>r1</td><td>Removes value on top of stack, places in r1</td><td>r1 = stack.pop()</td><td></td></tr>
</tbody></table>
</div>
<p>You don't know what the stack is yet, but we will get to it in the <a href="./asm_memory.html">asm-memory</a> section.</p>
<hr />
<p>There is actually one more set of instructions we need to cover, and that's <em>control flow operations</em>, or operations that change the execution of the program (alter ip). They are so important that they get their own header.</p>
<h2 id="control-flow-instructions"><a class="header" href="#control-flow-instructions">Control Flow Instructions</a></h2>
<p>You understand how to do things linearly, but that's boring. You don't always want to do things so linearly. You often want conditions! Something like:</p>
<pre><code class="language-python">if(x is even):
    y = x + 1
else:
    y = x
</code></pre>
<p>In x86 you represent these types of things with conditional jumps. </p>
<h3 id="jump-instructions"><a class="header" href="#jump-instructions">Jump Instructions</a></h3>
<p>All jump instructions start with a <code>j</code>, go figure. Normal jumps, called unconditional jumps look like this:</p>
<pre><code>jmp 0xdeadbeef
</code></pre>
<p>Where you replace 0xdeadbeef with an address of some sort. This also works with registers, so <code>jmp [rax]</code> is a very valid thing too and introduces its own complexities. Conditional jumps start with a <code>j</code> and end with some mnemonic to signify what they are dependent on. As an example, you have <em>jump if less than or equal</em>:</p>
<pre><code>jle 0xdeadbeef
</code></pre>
<p><code>le</code> is dependent on something called the <a href="https://en.wikipedia.org/wiki/FLAGS_register">flags register</a>, which is altered based on instructions that cause comparisons and tests. The two most common comparisons are:</p>
<pre><code>cmp r1, &lt;r2 | C&gt;
test r1, r2
</code></pre>
<p><code>cmp</code> will subtract <code>r2</code> from <code>r1</code> to tell the difference. <code>test</code> will <code>AND</code> the two to tell the difference. These differences are stored in the flags registers. The most common format of their use is like so:</p>
<pre><code>cmp rax, rdx
jle addr2
addr1:
mov rbx, 1
jmp addr3
addr2:
mov rbx, 0
addr3:
mov rax, rbx
</code></pre>
<p>The use of the names like <code>addr1</code> here are labels. You can place labels anywhere in assembly and use them in jump instructions later. Thse labels will be converted into relative jumps at the time the code is assembled (right before running it).</p>
<p><strong>RECAP</strong>:</p>
<ul>
<li>Unconditional Jump: <code>jmp address</code></li>
<li>List of all conditional jumps: <a href="http://unixwiz.net/techtips/x86-jumps.html">here</a></li>
<li>Register flags: <a href="https://riptutorial.com/x86/example/6976/flags-register">here</a></li>
<li>cmp instruction: <a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/cmp">here</a></li>
<li>test instruction <a href="https://en.wikipedia.org/wiki/TEST_(x86_instruction)">here</a></li>
</ul>
<h3 id="call-instructions"><a class="header" href="#call-instructions">Call Instructions</a></h3>
<p>Finally, we have the last subset of instructions and that's call related instructions. They are a sub-set of control flow altering instructions and they work very much like jumps. There are two instructions:</p>
<ol>
<li><a href="https://www.felixcloutier.com/x86/call">call</a></li>
<li><a href="https://www.felixcloutier.com/x86/ret">ret</a></li>
</ol>
<p>Call works like this:</p>
<pre><code>call &lt;r1 | C&gt;
</code></pre>
<p>So you can call an address, label (like in the jumps), or a dereferenced register (<code>[rax]</code>). When you call something it actuall does two things:</p>
<pre><code>call addr:
1. decode instruction
2. push (rip + current_instruction_size)
3. jmp addr
</code></pre>
<p>You still don't know what the stack is, but know that its somewhere you can save stuff just like normal memory. If you push something on the stack, it is now saved on the stack until a corresponding pop. So, from this, we can extrapolate that a call instruction does a jump while saving the original next address on the stack. This save is for the corresponding instruction <code>ret</code>. The <code>ret</code> instruction takes optional args, but for now we will consider it takes nothing:</p>
<pre><code>ret
</code></pre>
<p>The ret instruction does the following:</p>
<pre><code>ret:
1. pop rip
</code></pre>
<p>So it directly modifies <code>rip</code> by taking whatever is on top of the stack and putting it into <code>rip</code>. So, in normal code, you can make a region of code you can reuse many times, called a <em>function</em>:</p>
<pre><code class="language-c">// args in rdi, output in rax
make_even:
mov rdx, rdi
mov rax, 2 
idiv 
mov rax, rdx    
cmp rax, 0 
je make_even_done
add rdi, 1
make_even_ret:
mov rax, rdi
ret

_start:
mov rdi, 10
call make_even
mov rdi, rax
...
</code></pre>
<p>This code above shows off the power of the <code>call</code>, <code>ret</code> combo, allowing you to return to execution after you do some action with registers and values. It also shows how to make a function, which we will cover more in <a href="./control_structures.html">control-structures</a>.</p>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>There are many instructions that make up the x86-64 architecture. It's actually one of the largest. You can find all instructions at the <a href="https://www.felixcloutier.com/x86/">felixcloutier site</a>, which I often use for references of hard-to-remember instructions. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../3_computer_organization/registers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../3_computer_organization/asm_memory.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../3_computer_organization/registers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../3_computer_organization/asm_memory.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
